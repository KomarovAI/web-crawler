# üöÄ Deployment Guide - Archive v5.2

## üìã –î–≤–µ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã

### 1Ô∏è‚É£ **–†–µ–∂–∏–º CRAWL** (–ù–æ–≤—ã–π –∞—Ä—Ö–∏–≤)

–ö—Ä–∞–π–ª–∏—Ç —Å–∞–π—Ç —Å –Ω—É–ª—è, —Å–æ–∑–¥–∞—ë—Ç –∞—Ä—Ö–∏–≤, —Ä–∞—Å–∫–∞—Ç—ã–≤–∞–µ—Ç –≤ —Ü–µ–ª–µ–≤–æ–π —Ä–µ–ø–æ.

```
‚Üì Crawl website
‚Üì Generate archive_domain/ folder
‚Üì Upload artifact
‚Üì Deploy to target repo
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –ü–µ—Ä–≤—ã–π —Ä–∞–∑ –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç–µ —Å–∞–π—Ç
- –ù—É–∂–Ω—ã —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ –∞—Ä—Ö–∏–≤–∞

---

### 2Ô∏è‚É£ **–†–µ–∂–∏–º REUSE** (–ü–æ–≤—Ç–æ—Ä–Ω–∞—è —Ä–∞—Å–∫–∞—Ç–∫–∞)

**–ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç –∫—Ä–∞–π–ª–∏–Ω–≥**, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∞—Ä—Ç–∏—Ñ–∞–∫—Ç –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –ø–∞–π–ø—ã.

```
‚úÖ Skip crawl (1-2 —á–∞—Å–∞ —ç–∫–æ–Ω–æ–º–∏–∏!)
‚Üì Download artifact from previous run
‚Üì Re-deploy to target repo
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –ù—É–∂–Ω–æ –ø–µ—Ä–µ—Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –∞—Ä—Ö–∏–≤ –≤ –¥—Ä—É–≥–æ–π —Ä–µ–ø–æ
- –ò—Å–ø—Ä–∞–≤–∏–ª–∏ –æ—à–∏–±–∫—É –≤ –ª–æ–≥–∏–∫–µ —Ä–∞—Å–∫–∞—Ç–∫–∏
- –•–æ—Ç–∏—Ç–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ —Ä–∞—Å–∫–∞—Ç–∏—Ç—å —É–∂–µ –≥–æ—Ç–æ–≤—ã–π –∞—Ä—Ö–∏–≤

---

## ‚öôÔ∏è –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ Fine-Grained PAT

**–°—Å—ã–ª–∫–∞**: https://github.com/settings/personal-access-tokens/new

### –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ

| –ü–æ–ª–µ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|------|----------|
| **Token name** | `web-crawler-deployment` |
| **Expiration** | `90 days` |
| **Description** | `For deploying archives - FULL REPO RESET` |
| **Repository access** | `Select repositories` ‚Üí –≤—ã–±–µ—Ä–∏ —Ü–µ–ª–µ–≤–æ–π —Ä–µ–ø–æ |
| **Contents** | ‚úÖ Read and write |

**–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ**:
1. Generate token
2. **–°–∫–æ–ø–∏—Ä—É–π —Ç–æ–∫–µ–Ω** (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑!)

---

## ‚öôÔ∏è –®–∞–≥ 2: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ Secret

**–°—Å—ã–ª–∫–∞**: https://github.com/KomarovAI/web-crawler/settings/secrets/actions

### –§–æ—Ä–º–∞

```
Name: EXTERNAL_REPO_PAT
Secret: <–≤—Å—Ç–∞–≤—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω>
```

---

## üß™ –®–∞–≥ 3: –ó–∞–ø—É—Å–∫ Workflow

### –†–µ–∂–∏–º CRAWL (–Ω–æ–≤—ã–π –∞—Ä—Ö–∏–≤)

1. **Actions ‚Üí Archive v5.2 ‚Üí Run workflow**
2. –ó–∞–ø–æ–ª–Ω–∏:
   ```
   url: https://example.com
   max_pages: 50
   use_selenium: true
   target_repo: your-username/archive-repo
   reuse_artifact_run_id: (–æ—Å—Ç–∞–≤—å –ø—É—Å—Ç–æ)
   ```
3. **Run workflow**

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –°–∞–π—Ç –±—É–¥–µ—Ç –∫—Ä–∞–π–ª–µ–Ω, –∞—Ä—Ö–∏–≤ —Å–æ–∑–¥–∞–Ω –∏ —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç (~2 —á–∞—Å–∞).

---

### –†–µ–∂–∏–º REUSE (–ø–æ–≤—Ç–æ—Ä–Ω–∞—è —Ä–∞—Å–∫–∞—Ç–∫–∞)

1. **Actions ‚Üí Archive v5.2 ‚Üí Run workflow**
2. –ó–∞–ø–æ–ª–Ω–∏:
   ```
   url: https://example.com (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –∑–∞–ø–æ–ª–Ω–∏ —á—Ç–æ-—Ç–æ)
   max_pages: 1 (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
   use_selenium: false (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
   target_repo: your-username/new-archive-repo
   reuse_artifact_run_id: 20328733763  ‚Üê ID –ø—Ä–µ–¥—ã–¥—É—â–µ–π –ø–∞–π–ø—ã!
   ```
3. **Run workflow**

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ê—Ä—Ö–∏–≤ –∏–∑ –ø–∞–π–ø—ã #20328733763 –±—É–¥–µ—Ç —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç –≤ –Ω–æ–≤—ã–π —Ä–µ–ø–æ (~5 –º–∏–Ω—É—Ç).

---

## üìç –ì–¥–µ –Ω–∞–π—Ç–∏ Run ID

### –í–∞—Ä–∏–∞–Ω—Ç 1: GitHub UI
1. **Actions ‚Üí Archive v5.2**
2. –ö–ª–∏–∫ –Ω–∞ –Ω—É–∂–Ω—ã–π run
3. URL: `github.com/KomarovAI/web-crawler/actions/runs/**20328733763**`
   - **20328733763** ‚Üê —ç—Ç–æ Run ID

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ü—Ä—è–º–æ–π URL
```
https://github.com/KomarovAI/web-crawler/actions/runs/20328733763
                                                        ^^^^^^^
                                                        Run ID
```

---

## üìä –õ–æ–≥–∏–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### –ï—Å–ª–∏ `reuse_artifact_run_id` –ü–£–°–¢–û–ô:
```
‚úÖ validate-inputs
‚îú‚îÄ ‚úÖ archive (CRAWL - –∫—Ä–∞–π–ª–∏—Ç —Å–∞–π—Ç)
‚îú‚îÄ ‚è≠Ô∏è  reuse-artifact (–ø—Ä–æ–ø—É—â–µ–Ω)
‚îî‚îÄ ‚úÖ deploy (—Ä–∞—Å–∫–∞—Ç—ã–≤–∞–µ—Ç –Ω–æ–≤—ã–π –∞—Ä—Ö–∏–≤)
```

### –ï—Å–ª–∏ `reuse_artifact_run_id` –ó–ê–ü–û–õ–ù–ï–ù:
```
‚úÖ validate-inputs
‚îú‚îÄ ‚è≠Ô∏è  archive (–ø—Ä–æ–ø—É—â–µ–Ω)
‚îú‚îÄ ‚úÖ reuse-artifact (—Å–∫–∞—á–∏–≤–∞–µ—Ç —Å—Ç–∞—Ä—ã–π –∞—Ä—Ç–∏—Ñ–∞–∫—Ç)
‚îî‚îÄ ‚úÖ deploy (—Ä–∞—Å–∫–∞—Ç—ã–≤–∞–µ—Ç —Å—Ç–∞—Ä—ã–π –∞—Ä—Ö–∏–≤)
```

---

## üíæ –ê—Ä—Ç–∏—Ñ–∞–∫—Ç—ã

### –ì–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è
- **GitHub Actions**: Actions tab ‚Üí Artifacts
- **–í—Ä–µ–º—è –∂–∏–∑–Ω–∏**: 90 –¥–Ω–µ–π
- **–†–∞–∑–º–µ—Ä**: –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∞—Ä—Ö–∏–≤–∞ (~100MB-1GB)

### –ò–º—è –∞—Ä—Ç–∏—Ñ–∞–∫—Ç–∞
```
archive-{run_id}
```

–ü—Ä–∏–º–µ—Ä: `archive-20328733763`

---

## üö® Troubleshooting

### ‚ùå "Artifact not found"
**–ü—Ä–∏—á–∏–Ω–∞**: Run ID –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –∞—Ä—Ç–∏—Ñ–∞–∫—Ç —É–¥–∞–ª—ë–Ω (>90 –¥–Ω–µ–π)
**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑—É–π –∞–∫—Ç—É–∞–ª—å–Ω—ã–π Run ID, –∞—Ä—Ç–∏—Ñ–∞–∫—Ç—ã —Ö—Ä–∞–Ω—è—Ç—Å—è 90 –¥–Ω–µ–π

### ‚ùå "Invalid run ID format"
**–ü—Ä–∏—á–∏–Ω–∞**: Run ID –Ω–µ —á–∏—Å–ª–æ–≤–æ–π
**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–ª —Ç–æ–ª—å–∫–æ —á–∏—Å–ª–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `20328733763`)

### ‚ùå "Archive not found in artifact"
**–ü—Ä–∏—á–∏–Ω–∞**: –î—Ä–µ–≤–Ω–∏–π –∞—Ä—Ç–∏—Ñ–∞–∫—Ç –±–µ–∑ –∞—Ä—Ö–∏–≤–∞
**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑—É–π –±–æ–ª–µ–µ —Å–≤–µ–∂–∏–π Run ID

### ‚ùå "Permission denied" (deploy)
**–ü—Ä–∏—á–∏–Ω–∞**: EXTERNAL_REPO_PAT –Ω–µ –∏–º–µ–µ—Ç –ø—Ä–∞–≤
**–†–µ—à–µ–Ω–∏–µ**: –ü–µ—Ä–µ—Å–æ–∑–¥–∞–π Fine-Grained PAT —Å "Contents ‚Üí Read and write"

---

## üìù –ü—Ä–∏–º–µ—Ä—ã –∫–æ–º–∞–Ω–¥

### –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å Run ID —Å GitHub Actions
```bash
# –ò–∑ URL
https://github.com/KomarovAI/web-crawler/actions/runs/20328733763
# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å: 20328733763
```

### –ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π —É—Å–ø–µ—à–Ω—ã–π Run ID (bash)
```bash
gh run list --repo KomarovAI/web-crawler \
  --workflow=archive_v5.2.yml \
  --status=success \
  --limit=1 \
  --json databaseId \
  --jq '.[0].databaseId'
```

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç

### –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ (CRAWL)
- [ ] –°–æ–∑–¥–∞–ª Fine-Grained PAT
- [ ] –í—ã–±—Ä–∞–ª —Ü–µ–ª–µ–≤–æ–π —Ä–µ–ø–æ –≤ PAT
- [ ] –î–∞–ª "Contents ‚Üí Read and write"
- [ ] –î–æ–±–∞–≤–∏–ª EXTERNAL_REPO_PAT secret
- [ ] –ó–∞–ø–æ–ª–Ω–∏–ª URL, max_pages
- [ ] –û—Å—Ç–∞–≤–∏–ª reuse_artifact_run_id –ø—É—Å—Ç—ã–º
- [ ] –ó–∞–ø—É—Å—Ç–∏–ª workflow
- [ ] –ü—Ä–æ–≤–µ—Ä–∏–ª —á—Ç–æ –∞—Ä—Ö–∏–≤ —Å–æ–∑–¥–∞–Ω (~2 —á–∞—Å–∞)

### –ü–æ–≤—Ç–æ—Ä–Ω–∞—è —Ä–∞—Å–∫–∞—Ç–∫–∞ (REUSE)
- [ ] –ù–∞—à—ë–ª Run ID —É—Å–ø–µ—à–Ω–æ–≥–æ –∫—Ä–∞–π–ª–∞
- [ ] –ó–∞–ø–æ–ª–Ω–∏–ª reuse_artifact_run_id
- [ ] –£–∫–∞–∑–∞–ª –Ω–æ–≤—ã–π target_repo
- [ ] –ó–∞–ø—É—Å—Ç–∏–ª workflow
- [ ] –ü—Ä–æ–≤–µ—Ä–∏–ª —á—Ç–æ –∞—Ä—Ö–∏–≤ —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç (~5 –º–∏–Ω—É—Ç)

---

## üìû References

- [GitHub Personal Access Tokens](https://github.com/settings/personal-access-tokens)
- [GitHub CLI: run list](https://cli.github.com/manual/gh_run_list)
- [workflow file](https://github.com/KomarovAI/web-crawler/blob/main/.github/workflows/archive_v5.2.yml)
