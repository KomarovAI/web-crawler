name: ğŸš€ Download Website

on:
  workflow_dispatch:
    inputs:
      url:
        description: 'Website URL to download'
        required: true
        default: 'https://example.com'
      method:
        description: 'Download method'
        required: true
        default: 'httrack'
        type: choice
        options:
          - httrack
          - wget
          - monolith
          - all

jobs:
  download:
    runs-on: ubuntu-latest
    timeout-minutes: 60
    
    permissions:
      contents: write
      actions: read
    
    steps:
      - name: ğŸ« Checkout repository
        uses: actions/checkout@v4
      
      - name: ğŸ’ª Install tools
        run: |
          sudo apt-get update
          sudo apt-get install -y wget httrack
          
          # Install Monolith
          curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y
          source $HOME/.cargo/env
          cargo install monolith --locked
      
      - name: ğŸ’ Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      
      - name: ğŸ“š Install Python dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests beautifulsoup4
      
      - name: ğŸš€ Download website
        run: |
          mkdir -p downloads
          python3 downloader/site_downloader.py "${{ github.event.inputs.url }}" \
            --method "${{ github.event.inputs.method }}" \
            --dir downloads
      
      - name: ğŸ“‚ Create archive
        run: |
          cd downloads
          # Create tar archive
          tar -czf ../website_backup_$(date +%Y%m%d_%H%M%S).tar.gz ./*
          cd ..
          
          # Create zip archive (for Windows users)
          zip -r website_backup_$(date +%Y%m%d_%H%M%S).zip downloads/
      
      - name: ğŸ“¤ Upload artifacts
        uses: actions/upload-artifact@v3
        with:
          name: website-downloads
          path: |
            downloads/
            *.tar.gz
            *.zip
          retention-days: 90
      
      - name: ğŸ“ Generate report
        run: |
          echo "# ğŸš€ Website Download Report" > download_report.md
          echo "" >> download_report.md
          echo "## Summary" >> download_report.md
          echo "- **URL**: ${{ github.event.inputs.url }}" >> download_report.md
          echo "- **Method**: ${{ github.event.inputs.method }}" >> download_report.md
          echo "- **Time**: $(date)" >> download_report.md
          echo "- **Status**: âœ… Success" >> download_report.md
          echo "" >> download_report.md
          echo "## Downloads Statistics" >> download_report.md
          echo "\`\`\`" >> download_report.md
          du -sh downloads/* 2>/dev/null || echo "No files downloaded" >> download_report.md
          echo "\`\`\`" >> download_report.md
          echo "" >> download_report.md
          echo "## Files" >> download_report.md
          echo "\`\`\`" >> download_report.md
          find downloads -type f | head -20 >> download_report.md
          echo "\`\`\`" >> download_report.md
      
      - name: ğŸ“¢ Comment on workflow
        uses: actions/github-script@v7
        if: always()
        with:
          script: |
            const fs = require('fs');
            const report = fs.readFileSync('download_report.md', 'utf8');
            core.summary
              .addHeading('ğŸš€ Website Download Complete')
              .addRaw(report)
              .write();

  notify:
    runs-on: ubuntu-latest
    needs: download
    if: always()
    
    steps:
      - name: âœ… Success
        if: needs.download.result == 'success'
        run: echo "ğŸŒŸ Website downloaded successfully!"
      
      - name: âŒ Failed
        if: needs.download.result == 'failure'
        run: echo "ğŸ’¥ Download failed! Check logs above."
